define(["Handlebars","underscore"],function(a,b){function c(d,e){return e=e||{},d&&d.type==="program"&&d.statements&&(b(d.statements).forEach(function(b,f){var g="<!-- i18n error -->";b.type=="mustache"&&b.id&&b.id.original=="$"?(b.params.length&&b.params[0].string&&(g=e[b.params[0].string]||g),d.statements[f]=new a.AST.ContentNode(g)):b.program&&(b.program=c(b.program,e))}),d.inverse&&c(d.inverse,e)),d}return function(b,d,e){e=e||{};var f,g;return f=a.parse(b),d!==!1&&(f=c(f,d)),g=(new a.Compiler).compile(f,e),(new a.JavaScriptCompiler).compile(g,e)}})